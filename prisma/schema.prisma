generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  email     String   @unique
  name      String
  passwordHash String
  phone     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  addresses Address[]
  orders    Order[]
}

model Address {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  user          User?    @relation(fields: [userId], references: [id])
  userId        String?  @db.ObjectId
  name          String
  addressLine1  String
  addressLine2  String?
  city          String
  state         String
  pincode       String
  country       String
  phone         String?
  createdAt     DateTime @default(now())
}

model Product {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  productId     String   @unique
  sku           String   @unique
  title         String
  slug          String   @unique
  category      String
  price         Float
  costPrice     Float?
  stockQty      Int      @default(0)
  weight        Float?
  metalFinish   String
  images        String   // JSON string array
  description   String
  shortDesc     String?
  tags          String   // JSON string array
  sizeOptions   String?  // JSON string array
  shippingClass String?
  isNew         Boolean  @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  orderItems OrderItem[]
}

model Order {
  id               String   @id @default(auto()) @map("_id") @db.ObjectId
  orderNumber      String   @unique
  user             User?    @relation(fields: [userId], references: [id])
  userId           String?  @db.ObjectId

  subtotal         Float
  shipping         Float
  total            Float
  paymentMethod    String
  paymentStatus    String
  status           String

  customerName     String
  customerEmail    String
  customerPhone    String

  shipName         String
  shipAddressLine1 String
  shipAddressLine2 String?
  shipCity         String
  shipState        String
  shipPincode      String
  shipCountry      String

  razorpayOrderId  String?
  razorpayPaymentId String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  items OrderItem[]
  tasks Task[]
}

model OrderItem {
  id        String  @id @default(auto()) @map("_id") @db.ObjectId
  order     Order   @relation(fields: [orderId], references: [id])
  orderId   String  @db.ObjectId
  product   Product @relation(fields: [productId], references: [id])
  productId String  @db.ObjectId
  sku       String
  title     String
  quantity  Int
  price     Float
  image     String?
}

model Task {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  order       Order    @relation(fields: [orderId], references: [id])
  orderId     String   @db.ObjectId
  type        String
  status      String
  assignedTo  String
  assignedBy  String
  priority    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  completedAt DateTime?
}


